---
description: EverQuest Emulator Server code changes for year 2011
---

# 2011

## 12/12/2011

* **Trevius** Pets set to a petpower of -1 in the pets table will scale stats to the petpower like they used to.

## 12/11/2011

* **Bad\_Captain** Fixed hatelist/aggro bug I introduced in rev 2087 causing NPCs to attack the closest client instead of the top of their hatelist.
* **Bad\_Captain** Updated some live opcodes for EQExtractor.

## 12/06/2011

* **Leere** Added IsFromSpell to Attack\(\) to allow its use from spell effects. This allows the Rampage AA to actually hit mobs again.
* **Leere** Added a rule for the minium hasted delay that can be reached for weapons. Default set to 400 based on best guesses from the Moss-Covered Twig tests posted on the net.
* **Congdar** \(ptarp\)compile warnings in windows
* **Bad\_Captain** Fixed Enchanter's Mezmerization AA \* it was extending buffs 35%, now extends mez spells by 1 tick / rank.
* **Bad\_Captain** Fixed NPC aabonuses issue\(s\) \* NPCs were trying to access nonexistent aabonuses within combat code \(hatemod as an example\)
* **Bad\_Captain** Temporary Fix on crash due to non-player spell proc from Monster Summoning Pets until I can figure out the cause.
* **Bad\_Captain** Bot changes / fixes including maintaining HP & Mana after camp/zone/death, ability to maintain aggro over clients, taunting toggle command \(\#bot taunting \[on\|off\]\), delay death AA, and others. Please see [http://www.eqemulator.org/forums/showthread.php?p=205139\#post205139](http://www.eqemulator.org/forums/showthread.php?p=205139#post205139) for all Bot changes.

Required SQL: 2087\_required\_bots\_hp\_and\_mana\_and\_spell\_updates.sql

## 12/05/2011

* **Trevius** Crash fix for trying to zone into a flagged zone without having the flag.

## 12/04/2011

* **Secrets** Added QueryServ for VS2010 x86/x64. QueryServ allows queries to be sent to it for use on an external database, through the means of packets.

  Currently, the only thing it logs is a \#command input, but that will be expanded onto soon. A suggestion for our developers would be to move any statistic logging stuff \(hackers table, eventlog, etc\) over to it eventually

  to save processing power on the main executable's machine. This will allow for things like discovered items to work a bit more better resource-wise.

* **Akkadius** Added \#advnpcspawn setversion \(version\#\) \* This will change the instance version in which the targeted NPC resides in
* **Akkadius** Added \#npcedit setanimation \(stand, sit, crouch, dead, loot \(0-4\)\) so that setting animations are much easier. This also makes animations much more reliable setting them with the spawn packet rather than through Perl.
* **Akkadius** Added /MP switch to VS2008 so that it will compile with multiple processors
* **Akkadius** Fixed compiles for VS2008 from the Queryserv commit
* **Secrets** Added \#qtest , which will populate the remote database through QueryServ with information as a test only. Requires 255 status by default.
* **Trevius** LDoN points are now capped at 2,000,000,000 instead of ~16,000, and no longer roll back to 0 if they exceed the cap limit.

Reccomended SQL: \(ON QueryServ's database, NOT the main db\) utils/sql/queryserver/2079\_queryserver.sql

## 12/01/2011

* **Secrets** v90 toolset bugs reported on forums. In order to use Perl 5.14, you MUST upgrade to VS2010 \(preferrably ultimate\), if you do not have vs2010, it will default to Perl 5.10 and you will be unable to use the much more stable Perl 5.14, an upgrade is reccomended.
* **Secrets** Fixed Windows x64 rulesys bug where it would store them as an x64 version of an int \(long long\) and mess up the ordering of pointers, resulting in certain rules not loading properly.

  NOTE: For those having issues compiling vs2010, there will be a guide up shortly to help you set up your dev environment. In the meantime, make sure your "Additional Include" and "Additional Library" paths

  are correct and pointing at the right location. Failure to do so will result in mysql header/lib and perl header/lib issues. If you are looking for zlib x64, it's in SVN.

## 11/30/2011

* **Secrets** Implemented Visual Studio 11 and Visual Studio 10 project/sln files.
* **Secrets** Added x64 configuration settings to VS11 and VS10 project files/SLN files.
* **Secrets** Changed WIN32 define to \_WINDOWS across the board. In the case where WIN32 is needed over WIN64 \(ie; assembly references\) there is still WIN32 defines and a new WIN64 define.
* **Secrets** Upgraded ActiveState Perl lib define to 5.14 -\* others still work but it is strongly reccomended to use 5.14 as it contains less memory leaks.
* **Secrets** Added Zlib 1.2.3 x64 to the SVN for use with the windows solution files.
* **Secrets** Fixed vs2008 project files to reflect the new \_WINDOWS define
* **Secrets** Perl 5.14 Compile Fix

NOTE: Since VS11 is in beta, I only set up the debug options. You should use Vs2010 Ultimate to compile in x64 mode. NOTE2: Perl 5.14 is stable, but if you absolutely need to use 5.10, ctrl f search for "perl514.lib" and replace it with "perl510.lib" NOTE3: A forum post will be made for help with compiling Windows x64 on EQEmulator.org, it is an experimental feature but has less issues than x64 linux, imo.

## 11/28/2011

* **Leere** Fixed a problem with no drop items inside of bags when trading with NPCs. Pets retain buff based procs through zoning now.

## 11/26/2011

* **Leere** NPCs now have the ability to ignore level limits for stuns. This ability can be turned off via rule. Also added a rule for what the base stun immunity level is for spells with a max level of 0.
* **Leere** NPCs \(and thus pets\) are now able to equip items in non-visble slots. They will also look inside of bags that are traded to them for those items.

  The pets table was expanded. It can now map to several npc IDs for the same pet type string, based on pet power. \(This has replaced the old approach of letting pet power be a direct boost to NPC stats. The intention is to now have distinct npc\_type table entries for the various pet power levels that a pet supports.\) Pet naming and pet control was likewise moved out of code logic and to the pets table. \(The default pet control is now petFamiliar rather than petOther.\) Pets can now have items already equipped when summoned. The equipment sets used for that can be shared between pets and also be nested up to a depth of 5.

  Pets are no longer stored as part of the profile blobs.

  Pets \(charmed and summoned\) belonging to clients should no longer attempt to assist other NPCs if they hear a call for help.

Required SQL: utils/sql/sv/2069\_required\_pets.sql

## 11/21/2011

* **Akkadius** Implemented NPC Special Attack 'Z'. This will keep clients from being able to attack an NPC altogether similar to live.

## 11/17/2011

* **Congdar** Fix charms Platinum Disc and Gold Pin. You'll need updated items\CHRMGold.pl and \items\CHRMPlatinum.pl once pushed to the quest repository.

## 11/17/2011

* **Lerxst** Fixed crash when calculating random focus effect from an augment when the base item had no focus effect.

  Also added some bulletproofing in case that isn't the only place an invalid spell id might be passed.

## 11/16/2011

* **Akkadius** Added the ability to specify doors/objects/ground spawns to load for all versions of the same zone regardless by setting the value to -1.

  This reduces serious redundancy of copying the same data over and over for instances.

Required SQL: utils/sql/svn/2062\_required\_version\_changes.sql

## 11/15/2011

* **Trevius** Potential zone crash fix for Discovered Items pointed out by Congdar.

## 11/09/2011

* **Trevius** Fixes for issues caused by the extra SoF+ item click checks.

## 11/05/2011

* **Trevius** Added extra checks for SoF+ item clicks.

## 11/01/2011

* **Trevius** Added Discovered Items table to track who discovered an item for the first time and when.
* **Trevius** Added new EVENT\_DISCOVER\_ITEM player event.  It exports the item id to the $itemid variable.
* **Trevius** Added Rule Character:EnableDiscoveredItems to make item discovery tracking optional.

Required SQL: utils/sql/svn/2057\_required\_discovered\_items.sql

Optional SQL: utils/sql/svn/2058\_optional\_rule\_discovered\_items.sql

## 10/31/2011

* **Leere** Changed raid leadership ability costs to match client expectations.
* **Leere** All stuns should now treat a max level of 0 as meaning level 55.

## 10/24/2011

* **Akkadius** Mysql CLI changes
* **Akkadius** Preliminary work to some future additions, added int32 Database::GetGuildDBIDByCharID\(int32 char\_id\)

## 10/23/2011

* **Akkadius** Another memory leak in parser.cpp, NewEventList never deallocated
* **Akkadius** Reduced code checking redundancy in several places regarding functions that reference ExecWeaponProc, only valid invalid spells are checked and logged.
* **Akkadius** \(Lerxst/Akkadius\) Approximately 8 memory leak fixes based on findings from 'cppcheck', some found in loot, popup windows and a few other places.
* **Akkadius** \(Lerxst\) Various quest object fixes, sanity checks and initiator adjustments
* **Akkadius** \(Lerxst\) Minor trading code adjustments
* **Akkadius** \(Lerxst\) Logic fixes with bot code
* **Sorvani** Critical hit filter should work again.
* **Secrets** Reverted my changes.

## 10/22/2011

* **Derision** Underfoot: Extended Buffs should now last the correct time without needing to zone.

## 10/21/2011

* **Derision** Fixed rez bug.
* **Akkadius** Fixed a spell crash that has been reported on The Hidden Forest with TryFadeEffect
* **Akkadius** Fixed a spell crash with ExecWeaponProc when a spell or weapon procs a spell that does not exist, you can catch the invalid spells in your spells log if you have them enabled

## 10/20/2011

* **Trevius** Fix for Perl Doors GetID\(\) command.
* **Akkadius** Mysql \#command CLI \* Fixed an issue where the query string was being escaped
* **Akkadius** Mysql \#command CLI \* Added switches -s and -h. Switch -s providing space between the select lines in a query, -h highlighting every other row to be more readable

## 10/19/2011

* **KLS** \(lerxst2112\) Client::Message memory leak
* **Trevius** Potential crash fix for MoveTo\(\) being used on an NPC that has a grid with wandertype 3.

## 10/14/2011

* **Leere** More than 6 members of a raid can now receive raid experience.
* **Sorvani** Added AE Rampage message and filter

## 10/11/2011

* **KLS** Added Ebon/Radiant crystal reclaim for the clients I have.\(Titanium/SoD/Underfoot\)
* **KLS** Seperated buffs from the player profile.
* **KLS** Seperated buffs allowed me to fix the counters on buffs for the newer clients across zone lines, as well as melee and magic runes are no longer limited to 65k as they are no longer uint16s.
* **KLS** Added ability to save variables to items. Via $client-&gt;SetCustomItemData\(13, "SomeVariable", 1024\); \#give our mainhand some variable.
* **KLS** Added ability to retrieve items from the inventory in perl with $client-&gt;GetItemInInventory\(slot\_id\);
* **KLS** Fixed Item::IsAugmentable\(\) to return correctly if the first augment slot is not used.
* **KLS** Updated for latest code and readded Derisions' cross-zone /inviting.  I've been testing it for a while now and can't find any real issues with it so I readded it.
* **KLS** Added class and race combo's into the database so they can be potentially changed; only SoF+ clients will correctly display this.
* **KLS** Fixed a bug in WorldDatabase::GetCharSelectInfo.
* **KLS** Changed internal faction values to go in order this change will break some quests in the short term but should be more intuitive in the long run.
* **KLS** Changed player.pl loading slightly: it will now look for player quests in the following order: .\quests{zone}\player\_v{instance\_version}.pl, .\quests{zone}\player.pl, .\quests\templates\player.pl
* **KLS** CanClassX functions are no longer hardcoded, they will now check the skillcaps data instead.
* **KLS** EntityVariables are now identified with a string instead of an int ex: $npc-&gt;SetEntityVariable\("SomeId", 5\), this shouldn't break any existing quests.
* **KLS** Fixed an issue where bard songs could get stuck in the _on_ position even if the bard had turned singing off.
* **KLS** Fixed an issue where merchants would load and send items more than once in cases where npcs had merchants that shared merchant\_ids in a zone.

## 10/09/2011

* **Akkadius** Fixed an optional argument in client 'NukeItem'
* **Akkadius** Added two \#npcedit commands; armortint\_id and alt\_currency\_id
* **Akkadius** Exported $client-&gt;GetAggroCount\(\);, this will get how many NPC's are aggroed on the client. This can also be used to determine when in combat.
* **Akkadius** Mysql ingame basic CLI to run select queries or execute queries from in-game, default account access 250, be careful when using this.
* **Akkadius** \(Lerxst\) Added a crash fix for spells that do not find a valid item in the database SE\_SummonItem

Optional SQL: utils/sql/svn/2023\_optional\_mysqlcli.sql

## 10/01/2011

* **Trevius** Added Destructible Objects for Underfoot.

## 09/25/2011

* **Derision** Implemented Tune Of Pursuance AA.

## 09/24/2011

* **JJ** Added hacker entry for possible instant camp disconnects.

## 09/23/2011

* **Trevius** Destructible Objects now change damage states as they reach 75%, 50%, 25% and 0%.
* **Trevius** Added Perl Mob quest object SendUntargetable\(to\_client, in\) to toggle the ability to be targeted.

## 09/22/2011

* **Trevius** Initial implementation of Destructible Objects \(SoD only for now\). Most of the work was done by Derision.

  To Create a Destructible Object, use the 'lastname' field in npc\_types to set the model \(ie. DEST\_DEV\_TENT1\), and add "o" in the 'npcspecialatks' field.

## 09/21/2011

* **Leere** Damage shields should no longer break root spells.

## 09/20/2011

* **Trevius** New rule added to allow a cap for GM skill training on specializations \(default is 50\).
* **Trevius** \#maxskills will now only set specializations to 50 each to prevent them from all resetting to 1.
* **Trevius** GM Trainers will no longer allow training more than 1 \(or 2 if you have the AA\) specializations above 50.
* **Bad\_Captain** Added rule for Bot AAs by expansion, bot bash fix \(bots with bask/slam skill could bash regardless of weapon\(s\) or shield\), various bot AA fixes, added a few bot AAs

Optional SQL: utils/sql/svn/2015\_optional\_specialization\_training\_rule.sql utils/sql/svn/2016\_optional\_rule\_bot\_aa\_expansion.sql

## 09/12/2011

* **Leere** \(Tabasco\) Added a deque for signals received by an NPC.
* **Sorvani** Various message type fixes, most notably NPC Flurry/Enrage/Rampage and Pet Flurry/Rampage.

## 09/05/2011

* **Akkadius** \(Akkadius/Lerxst\) Fixed Beastlord 1.5 and 2.0 pet clickies.

## 09/03/2011

* **KLS** Added working Alternate Currency system for SoD and SoF\(Untested but hopefully works\).
* **KLS** Added two fields to merchantlist that allows one to filter which items are offered to players by minimum faction and minimum level.
* **KLS** Max stacks on items increased from 254 to 32767.
* **Akkadius** Modified items id cap to 200,000
* **Akkadius** Changed Perl Client Object 'NukeItem' to use the new fields implemented by KLS's Alternate Currency revision:

  $client-&gt;NukeItem\(itemnum, \[where\_to\_check, 1 = invWhereWorn, 2= invWherePersonal, 4 = invWhereBank, 8 = invWhereSharedBank, 16 = invWhereTrading, 32 = invWhereCursor\]\); Ex: $client-&gt;NukeItem\(1001, 2\);

* **Akkadius** \(Lerxst\) Fixed Enduring Breath bot code, adjusted level requirements and added Beastlord class case.

Required SQL: utils/sql/svn/2004\_charges\_alt\_currency.sql

## 09/01/2011

* **Derision** Spell resist messages now use the same MT as fizzles \(for chat filter purposes\).

## 08/28/2011

* **Bad\_Captain** Rewrote Bot AAs to use aabonuses and GetAA\(\). Also added a few AAs.
* **Bad\_Captain** Fixed Bot chance to hit. \(they never missed with their primary weapon attacks, and only missed ~5% with their offhand\)
* **Bad\_Captain** Added WipeHateList to bot group attack, bot group follow, and bot group guard to allow target switching and keeps bots and their pets from attacking their target when you no longer want them to. \(suggested by Criimson\)

## 08/23/2011

* **Trevius** Exported to Perl Mob: SetDeltas\(delta\_x, delta\_y, delta\_z, delta\_h\), SetLD\(value\), SetTargetDestSteps\(target\_steps\).
* **Trevius** \(SuperUserJD\) SpellOnTarget fix for casting beneficial spells on group members while in a raid.

## 08/21/2011

* **Derision** Added rule to prevent looting corpses when a player has an item on the cursor \(to prevent item loss using Loot All\).
* **Derision** Alcohol intoxication is maintained across zoning \(can be turned off with a rule\).
* **Derision** Intoxication level affects STR/STA/DEX/AGI/WIS/INT.
* **Derision** Added 'Update' button to \#showstats window for SoD+ clients.

Optional SQL: utils/sql/svn/1998\_optional\_intoxication\_and\_looting\_rules.sql

## 08/18/2011

* **Leere** Removed lore item from the restrictions for pick pocket.

## 08/13/2011

* **Derision** Player pets will now show their owners name. UF users can turn this off in options.
* **Derision** SoD/UF: Beneficial Pet Buffs can be clicked off in the Pet Window.
* **Derision** Underfoot: Can now click off buffs in the short buff box. Removed registraion of HoT in patches.cpp

## 08/12/2011

* **Bad\_Captain** Fixed double class / race stats for bots.

## 08/09/2011

* **Derision** Underfoot: OP\_ClearSurname

## 08/05/2011

* **Akkadius** Corrected a grammatical error with training disciplines.

## 08/04/2011

* **Bad\_Captain** Updated Bot::MeleeMitigation to match mob version.

## 08/02/2011

* **Trevius** \(Akkadius\) Exported Freeze\(\) and UnFreeze\(\) to Perl Client.

## 07/27/2011

* **Caryatis** Added Special Attack 'p' \(Makes mob immune to pacify\)
* **Caryatis** Added Special Attack 'j' \(Tether \* returns mob to spawn point if its distance away from spawn point is greater than its aggro range\)
* **Caryatis** Added Special Attack 'J' \(Leash \* same as Tether except heals mob to full, strips all buffs and wipes the hatelist as well\)
* **Caryatis** Fixed TGB\(if you cast a group buff with a corpse or an npc thats not a client's pet as target, it will use your group instead\)

## 07/26/2011

* **Congdar** redo world container check

## 07/24/2011

* **Caryatis** Added support for higher level invis and see invis\(eg Ethereal Invisibility & Skylight Sagacity\)
* **Congdar** update check to world containers

## 07/23/2011

* **Congdar** \(Criimson\)Bot dyes \(and tweaks\)
* **Congdar** \(lerxst2112\)Bot dyes \(and tweaks\)
* **Bad\_Captain** Fixed Bot GetAC\(\) and GetATK\(\) to work with \#ShowStats

## 07/22/2011

* **Congdar** update check for Lore

## 07/17/2011

* **Congdar** \(pfyon, Criimson\)Various bot tweaks
* **Caryatis** Updated My/Showstats window.

Required SQL: utils/sql/svn/1974\_required\_bot\_spells\_update

## 07/16/2011

* **Trevius** Exported AssignToInstance\(instance\_id\) to Perl Client.

## 07/14/2011

* **Caryatis** Implemented the Extra Skill Damage itembonus\(+bash, +kick dmg\)

Optional SQL: utils/sql/svn/1972\_optional\_extradmg\_item\_cap.sql

## 07/14/2011

* **Leere** Fix for reading books in SoF and later clients.

## 07/13/2011

* **Derision** OP\_DisciplineUpdate for SoF and Underfoot \(expanded Disc struct in UF player profile, added encode for Disc update\).

## 07/12/2011

* **Caryatis** Added Perl Object: $mob-&gt;SetBodyType\(bodytype\).
* **Caryatis** Fixed issue with swarm\(and wake the dead\) pets where they would not despawn if they spawned as the target died.
* **Caryatis** Changed when mobs enrage to 9%\(from 14%\) to match live, with a rule to customize the value if wanted.
* **Caryatis** Added rule to allow matching of new live rules for enrage\(it was removed from all non player-pet npcs\).

Optional SQL: utils/sql/svn/1968\_optional\_enrage\_rules.sql

## 07/11/2011

* **erde** FreeBSD compile fix for Rev1963 \(no strncpy in FreeBSD\).

## 07/10/2011

* **Derision** Underfoot \* Support for /emote
* **Derision** Underfoot \* Support for Guild Creation via new window in Underfoot.
* **Derision** SoD+ \* Changing group leader should update Group Leadership AA to that of the new leader.
* **Caryatis** Live like focus effect behaviour added\(Improved Damage, Healing and Reduce Manacost focus effects will now be random if the spell contains both a min\(effect\_base\_value\) and max value\(effect\_limit\_value\)

Optional SQL:

utils/sql/svn/1962\_optional\_guild\_creation\_window\_rules.sql utils/sql/svn/1963\_optional\_rule\_live\_like\_focuses.sql

## 07/09/2011

* **Derision** Underfoot \* Instrument modifiers / AAs should now improve runspeed.

## 07/06/2011

* **Trevius** Fix for EVENT\_ITEM\_CLICK\_CAST bugging Titanium clients.

## 07/05/2011

* **Trevius** Fix for EVENT\_ITEM\_CLICK\_CAST for SoF+ clients.
* **Trevius** \(Akkadius\) Added new rule Console:SessionTimeOut for adjusting console session timeout.

Optional SQL: utils/sql/svn/1960\_optional\_console\_timeout\_rule.sql

## 07/02/2011

* **JJ** Split wander type 4 to allow depop with/without spawn timer. Type 4 is with, type 6 is without.

## 06/26/2011

* **JJ** Added functions to count all corpses, get corpse ids, and allow checking of items on player corpses

## 06/25/2011

* **JJ** \(Leere\) Fix for bards in reagent code

## 06/24/2011

* **KLS** Dest zone would buffer overflow if it was &gt;= 16 characters, fixed.
* **KLS** Comment clean up + added EntityList::FindDoor\($doorid\) to perlXS
* **KLS** Fixed the PerlXS export for GetDoorByID and GetDoorByDBID
* **Sorvani** Added door object perl functions GetKeyItem\(\), SetKeyItem\(\[value\]\), GetNoKeyring\(\), SetNoKeyring\(\[value\]\). Example Usage: my$doorobj = $entity\_list-&gt;FindDoor\(6\); $doorbj-&gt;SetKeyItem\(10615\); $doorbj-&gt;SetNoKeyring\(1\);
* **JJ** \(Akkadius\) Exported some task functions to perl.

## 06/23/2011

* **JJ** \(Sorvani\) Stop forcing client to tutorial when button not selected.

## 06/22/2011

* **Trevius** Added new Perl Mob quest object RemoveNimbusEffect\(effectid\) for removing permanent nimbus particle effects.
* **JJ** EVENT\_CLICKDOOR now passes the zone version to perl.

## 06/20/2011

* **JJ** Added message to client when using \#instance destroy command.
* **JJ** Altered doors index to include version to help bring door ids below 256 in zones with multiple versions. Required SQL provided.

Required SQL: utils/sql/svn/1946\_doors.sql

## 06/19/2011

* **JJ** \(Leere\) Fixed reagent consumption oddities

## 06/18/2011

* **JJ** Depop with spawntimer reset option now works properly. Default use is changed to false.
* **KLS** Added some minor stuff
* **KLS** Added animation field to spawn2 that will control what the spawned npc will do at their guard point. 0 = eaStanding, etc etc
* **KLS** Tweaked books in SoF+ as they weren't displaying right; it may still not be perfect though I haven't tested it with every book in the game. Required SQL Provided.

## 06/17/2011

* **KLS** Lowered resolution on QuestTimer process timer to actually allow you to use sub 1 second times.
* **KLS** Added quest::settimerMS\(timer, duration\) to allow timers not in integer second intervals.
* **JJ** Moved ENTERZONE event for items to execute before SCALE\_CALC.

## 06/15/2011

* **Secrets** Modified the pound command \#reloadstatic to respawn doors after it despawns them.
* **Secrets** Made the default door dest zone be "NONE" for quest::createdoor's constructor
* **Secrets** Added potential fix for UCS assertion error under windows after being up for so long.

## 06/14/2011

* **Secrets** Opcode to remove all doors.
* **Secrets** Perl door support.
* **Secrets** Perl objects added for Doors since first PerlDoors commit: SetSize, GetSize, SetIncline, GetIncline, GetOpenType, SetOpenType
* **Secrets** Added quest::createdoor\(model, x, y, z, h, \[opentype\], \[size\]\) . This spawns a door similar to quest::creategroundobjectfrommodel, and can be manipulated in the same way as other doors. To save it, get the door object using $entity\_list-&gt;GetDoorByID\(id\), as it returns an entity ID \(and preliminary DBID/DoorID is stored on the object itself\) upon creation of the door. otherwise the door is temporary, and does not save the stored DBID.  $doorobj-&gt;CreateDatabaseEntry\(\) saves it and its temporary DBID + DoorID.
* **Secrets** Added door object perl functions GetLockpick\(\) and SetLockpick\(\[value\]\).

## 06/10/2011

* **JJ** Added more tables to remove entries from when deleting character.

## 06/06/2011

* **Secrets** Adjusted the default value for Character:SkillCapMaxLevel. It now defaults to 75 because PEQ only has skillcaps up to 75, and if the level is higher than 75 it will always return 0, breaking skills. \(layer 8 issue fix\)
* **Secrets** Made stat cap adjustable via rules, Character:StatCap. The client won't be in sync but that's what \#mystats is for. 0 = feature disabled, defaults to 0.

## 06/05/2011

* **Derision** Fixed /yell

## 06/04/2011

* **Secrets** Fixed pet HP resetting if the pet is above 32k when zoning.
* **Secrets** Fixed player HP rollover bug \(~495k hitpoints, rarely encountered\) with AAs by temporarily casting it as a float.

  NOTE: the client only displays 10 million hitpoints in titanium. Keep that in mind when designing items. Only issue is displaying them, unlike the rollover bug you won't die and it will show on show/mystats.

* **Secrets** Fixed damage on weapons above 255. They only display on SoF+ clients, and Titanium will simply show a cosmetic issue \(an incorrect value\). You can set an item to any value up to the max for an uint32 and it will work.
* **Secrets** Added rules for the low-level damage cap. There is a rule for the pre-10 cap, and one for the pre-20 cap. Defaults to 20 and 40 respectively.

REQUIRED: You will have to recompile sharedmem with this update. Items will fail to load otherwise.

## 05/31/2011

* **Trevius** Added EVENT\_CLICK\_OBJECT to player quest events.  It exports variable $objectid which holds the entity id of the clicked object.

## 05/29/2011

* **Secrets** \(Akkadius\) Added quest::createguild\(name, leader\) for creating a brand new guild.

## 05/28/2011

* **Trevius** Added quest::getguildnamebyid\(guild\_id\) for getting a guild name from the guild ID.

## 05/25/2011

* **JJ** Implemented Arcane Tongues research AA. Chance for research success increases for each rank \(10, 25, 50\).
* **JJ** Implemented New Tanaan Crafting Mastery tradeskill AA. Each rank allows an additional tradeskill above 200.

  Note: For servers with players who have tradeskills already above the limit without previously purchasing these AAs will freeze the chance to increase until they purchase the proper amount of NTCM AAs.

## 05/24/2011

* **KLS** Changed Mob::NPCSpecialAttacks\(atk, perm\) to Mob::NPCSpecialAttacks\(atk, perm, \[reset = 1\], \[remove = 0\]\).

  This should allow one to add and remove flags individually without having to reset everything each time.

  ex:

  $npc-&gt;NPCSpecialAttacks\(RQ, 0\); //would enable the npc to rampage and quad.

  $npc-&gt;NPCSpecialAttacks\(S, 0, 0\); //Would enable the NPC to summon as well as rampage and quad by telling it to set S but don't reset the earlier flags.

ex: $npc-&gt;NPCSpecialAttacks\(RQS, 0\); //would enable the npc to rampage, quad and summon. $npc-&gt;NPCSpecialAttacks\(S, 0, 0, 1\); //Would enable the NPC rampage and quad by telling it to set S but don't reset the earlier flags and also remove the flag being set.

## 05/23/2011

* **JJ** \(Akkadius\) Fixed camera shake usage output.

## 05/22/2011

KLS and Co: -All liquid should count for skill ups. -Finished unified quest interface... this is fairly large and will probably have a few problems here and there; report them to me and ill fix them asap. The goal behind the system is to allow more than one scripting system to work at a time \(though with limited interaction due to pre-existing implementation limitation\). This was a feature requested by the Dalaya community as they plan to merge back to the eqemu codebase and clients but are stuck with an old parser and thousands of files that can't be realistically rewritten in a short time frame.

## 05/20/2011

* **JJ** Doubled buffer for tradeskill search when using experiment mode. Outputs message in error log when matches exceed buffer.

## 05/17/2011

* **JJ** Changed tradeskills to distinguish world containers in multiple recipe matches. Split invalid container vs. non-unique recipe error log entries. Allowed server to select first match for duplicate recipe contents.

## 05/16/2011

* **JJ** \(Zothen\) UCS message logic fix.
* **JJ** \(Zothen\) Learning basics clean name fix.

## 05/09/2011

* **KLS** \(lerxst2112\) \*nix compile fix.
* **KLS** Added \#picklock \#sensetrap and \#disarmtrap for LDoN traps since they still don't work quite right on the newer clients because we don't implement destructable objects yet.

## 05/08/2011

* **Congdar** \(Timothy\_nonax\) Add Bot Command \( \#bot pull \)

## 05/03/2011

* **Trevius** \(Vaion\) Fix for focus effect decay over max level.
* **Trevius** \(Zothen\) Crash fix for UCS.
* **Trevius** Rule added for Skill Caps Max Level to resolve issues with servers that have Chars over level 75 after Rev1875.

Optional SQL: utils/sql/svn/1889\_optional\_skill\_cap\_rule.sql

## 05/02/2011

* **Secrets** Added OP\_CameraEffect for Titanium.
* **Secrets** Added  _\*commands_ \#reloadallrules, \#reloadrulesworld, and \#camerashake. These default to
* **Secrets** Added optional "global" flag as item 5 in the $mob-&gt;CameraEffect\(\) quest object. This does \#camerashake, but in quest form.
* **Secrets** \#reloadallrules reloads rules in every single zone plus world. \#reloadrulesworld reloads the rules in world only.
* **Secrets** \#camerashake shakes the camera in every zone with required args intensity and duration.

## 04/24/2011

* **Trevius** Added new Perl Mob quest objects GetItemHPBonuses\(\) and GetSpellHPBonuses\(\).

## 04/17/2011

* **Secrets** Converted PVP flags to be a variable, as there are other PVP rulesets embedded in the client. These will need code support to work properly. \(IsAttackAllowed specifically.\)
* **Secrets** Enabled Firiona Vie ruleset as an option. This disables OOC, makes languages hard to understand between races \(somehow\), and disables no-drop. If set to 2, this rule will only affect GMs, allowing players to be traded no-drop items from GMs. Player-to-Player trades are still considered active hacks, and are still detected.
* **Secrets** Made a rule to toggle the GM Petition Window in titanium. You will need the guide petition files for that client, and it still needs code support to work. \(find these yourself.\)
* **Secrets** Added expansion settings to the rule\_values table instead of the variables. The PVP settings will also be here now, too. \(See Optional SQL with this update.\)
* **Secrets** Fixed an issue pointed out by Trevius in the previous commit.

Optional SQL: utils/sql/svn/1885\_optional\_rules\_fv\_pvp\_expansions.sql

## 04/13/2011

* **BadCaptain** Bot spell update\* Group Heals, debuff spells, spell recast timers, healing AI tweaked, bot bards can now have more than one song active

  Optional SQL: utils/sql/svn/1884\_optional\_bot\_spells\_update.sql

## 04/12/2011

* **Trevius** The mana regen portion of bard songs is no longer affected by instrument mods.
* **Trevius** \(scruffy\) Identified opcodes for /zone and petition queue on Titanium.

## 04/06/2011

* **Derision** Underfoot: Corrected OP\_CompletedTasks.

## 03/30/2011

* **Trevius** Implemented spell formulas 1001 to 1998.  They subtract/add values by increasing amounts each tick based on the formula \* 1000 value.

## 03/23/2011

* **JJ** \(Danyelle\) Face fix for Iksar Beastlord pet.

## 03/21/2011

* **JJ** \(Jaekob/Danyelle\) Texture fix for Iksar Beastlord pet.

## 03/11/2011

* **Trevius** Skill caps now use the MaxLevel rule for deciding max level of skill caps instead of being hard capped at level 75.
* **Trevius** All spells can be blocked in a zone by setting a spell id of 0 in the blocked\_spells table.
* **Trevius** If a zone has all spells blocked by setting spell id 0 in blocked\_spells, any additional spells added for that zone will become exceptions and be allowed.
* **Trevius** Reverted Sorvani's swarm pet change from Rev1872 due to some bugs it caused for normal pets.

## 02/24/2011

* **Trevius** Power Source slot can now be augmented.
* **Trevius** Corrected spell formula 122 \(Splurt\) and implemented the reverse splurt \(Ex. Corath Venom\) where damage reduces each tic.

## 02/22/2011

* **gaeorn** \(sorvani\) fix to make swarm pets not be targetable as NPCs

## 02/19/2011

* **Trevius** Added variable export $slotid to EVENT\_ITEM\_CLICK and EVENT\_ITEM\_CLICK\_CAST, which exports the slot id of the item that triggered the event.

## 02/18/2011

* **Trevius** Fixed a potential crash in TrySpellOnKill\(\).
* **Derision** Underfoot: Bard instrument modifiers now show \(as focus effects\) in the item stats window.
* **Derision** Allowed fishing in 'VWater' \(Region type 7\) on the basis this is the only type of water in Sleeper and you can apparently fish there.

## 02/17/2011

* **Derision** Fixed bug in GetZoneForage where generally only the first three zone specific items could actually be foraged.
* **gaeorn** \(sorvani\) fix for bard pacify songs

## 02/13/2011

* **Trevius** Finalized implementation of Item Faction Mods.  The bonuses now remove if the item is unequiped.
* **Trevius** Added Rule Character::ItemCastsUseFocus \* If true, this allows item clickies to use focuses that have limited max levels on them
* **Derision** Handle Spell duration formula 15 \(for Distillate of Skinspikes\).

Optional SQL: utils/sql/svn/1859\_optional\_item\_casts\_use\_focus\_rule.sql

## 02/11/2011

* **Trevius** Implemented item faction modifier stats \(i.e. factionmod1, factionamt1\).
* **Trevius** Added Power Source slot to item stat \(charm\) scaling.
* **Derision** SoD+: Fixed bug when looting items from last two inventory slots \(commonly seen when using Loot All\).
* **gaeorn** only send hp/mana/endurance updates to group members when in raid instead of entire raid

## 02/10/2011

* **JJ** \(c0ncrete\) Fixed shared bank database query to match schema.

## 02/08/2011

* **Trevius** Replaced most uses of strncpy with strn0cpy for consistency and stability.
* **Trevius** Increased zone name loading to 32 characters for doors.

Required SQL: utils/sql/svn/1847\_required\_doors\_dest\_zone\_size\_32.sql

## 02/07/2011

* **Derision** SoD/UF: /makeleader and changing Group Leader via Roles works.
* **Derision** If the leader of a group of exactly 3 members quits, leadership should now be transferred to another member.

## 01/30/2011

* **Caryatis** Stability fixes for Mystats window.

## 01/26/2011

* **Derision** Support for door opentype 57 \(instant intra-zone portals which don't require the client to click, such as in the bazaar\).

Note: For opentype 57, the client automatically sends the click when the player moves onto the portal.

Optional SQL, to set the bazaar portal discs to type 57 \(they are type 58 in the PEQ database, but collects show they should be type 57\):

update doors set opentype = 57 where zone = 'bazaar' and name = 'PORTAL\_DISC';

## 01/24/2011

* **Trevius** Exported GetFreeSpellBookSlot\(start\_slot=0\) and GetSpellBookSlotBySpellID\(spell\_id\) to Perl Client.
* **Trevius** Fix for potential crash with EVENT\_ITEM\_CLICK.
* **Trevius** \(Secrets\) Identified OP\_SpellEffect for Titanium.
* **Congdar** bad\_captain: more Bot Updates / Fixes V 2.0

## 01/22/2011

* **Congdar** fix stack buffer overflow

## 01/20/2011

* **Congdar** bad\_captain: Bot Updates / Fixes V 2.0

## 01/18/2011

* **Trevius** Changed Perl NPC AddItem\(itemid, charges, slot = 0\) to AddItem\(itemid, charges = 0, equipitem = true\) since slot was unused anyway.
* **Trevius** Added equipitem option to quest::addloot\(item\_id, charges = 0, equipitem = true\).

## 01/16/2011

* **Caryatis** Fix for Phantom line of discs not working.
* **Caryatis** Fix for buffdurationformula 5\(0 value results in a 3 tick spell, was set to 1 tick\).
* **Caryatis** Fix for discs\(and AAs\) setting a reuse timer if used while not able to\(ie stunned\)
* **Caryatis** Implemented SE\_VoiceGraft
* **Caryatis** Added scaling for pet focus items based on the pet power in the spell file.

## 01/15/2011

* **Caryatis** Fix for fear effects not fading when the buff does, also added check so that a negative recast is not set with SE\_ReduceReuse

## 01/14/2011

* **Trevius** \(l0stmancd\) Fix for invalid slot move warnings on SoF+ clients.
* **Trevius** \(l0stmancd\) Fix for potential item loss issue while using an inventory augmentation sealer.
* **Trevius** Adjustment to the augmentation code logic to remove potential issues.
* **Trevius** Added updateclient option to Perl Client TakeMoneyFromPP\(copper, updateclient=false\).
* **Derision** UF: Translated command code for /pet hold
* **Caryatis** Implemented SE\_ReduceReuseTimer\(epic 1.5/2.0 focuses, sof type3\), SE\_BlockNextSpellFocus\(chance to block next spell matching focus\)
* **Caryatis** Implemented SE\_SetBodyType, SE\_SpellOnDeath, SE\_BlockSpellEffect, SE\_Leap, SE\_ImmuneFleeing, SE\_AddMeleeProc
* **Caryatis** Delay Death AA is now functional\(optional sql\).

Optional SQL: utils/sql/svn/1823\_optional\_delay\_death.sql

## 01/13/2011

* **JJ** \(Leere\) Exported quest::LearnRecipe\(recipe\_id\) to PERL

## 01/12/2011

* **gaeorn** possible fix for some short duration buffs \(bard songs\) fading one tick early
* **Caryatis** Changed SE\_NoCombatSkills to SE\_CombatSkills\(0 = spells only, 1 = discs only\)
* **Caryatis** Implemented SE\_SpellDurationIncByTic\(formerly SE\_FocusCombatDurationMod\), it adds tics to spells/discs
* **Caryatis** Added support for Special Attack 'Y'\(Ranged Attack\), so when an NPC can't reach or summon his target, he will use range if able to
* **Caryatis** Implemented SE\_Forceful\_Rejuv\(refreshes spell gems\), SE\_HealFromMana, SE\_ManaDrainWithDmg, SE\_EndDrainWithDmg
* **Caryatis** Implemented SE\_LimitHPPercent, SE\_LimitManaPercent, SE\_LimitEndPercent\(limit you to a certain % while you have the buff\)
* **Caryatis** Implemented SE\_SwarmPetDuration\(swarm pet focus\)
* **Caryatis** Res Timer changes have been reverted temporarily.

Optional SQL: utils/sql/svn/1817\_optional\_npc\_archery\_bonus\_rule.sql

## 01/11/2011

* **gaeorn** fixed lull max level check to account for no max level
* **Caryatis** Change to Doppelganger NPCID due to PEQ's next rev already using the IDs.
* **Trevius** Added quest::stopalltimers\(\) to allow stopping all current timers on an NPC at one time.
* **Trevius** Added option to stop all timers when using \#reloadquest by adding any argument after the command \(ie. "\#reloadquest 1"\). Also added new \#rq alias for the command.

Required SQL: utils/sql/svn/1813\_required\_doppelganger\_npcid\_change.sql

## 01/09/2011

* **Caryatis** Viral spells are now supported\(field191 determines how many targets it will spread to and field 192 determines how often\(in seconds\)\).
* **Caryatis** Lull spells will now only work on the levels they were intended to.
* **Caryatis** Corpses now have a res timer\(like live\). You may res a corpse as many times as you want however you will only recieve exp for the first.

Optional SQL: utils/sql/svn/1809\_optional\_rules.sql

## 01/08/2011

* **Caryatis** Implemented Target's Target\(target type 46\). Places effect on your target's target\(ie cast with mob as target but spell lands on mob's target\)

## 01/05/2011

* **Trevius** Changed xpreward field in the tasks table to be signed so it can display negative values for the level based experience rewards.
* **Trevius** Tasks now show item links in Task Rewards correctly for all clients.
* **Trevius** Tasks now reward any set Experience and/or Coin even if the rewardmethod is set to 2 \(perl quest\).
* **Caryatis** Mobs now summon starting at 97%, not 94%\(like live\).
* **Caryatis** Charmed pets can no longer summon mobs from out of their LoS while charmed.
* **Caryatis** All fixed duration charm spells now have fixed duration instead of only 2 that were supported.
* **Caryatis** SpinStun effects now work on mobs up to the max level that the spell denotes\(previously limited to 55 regardless of spell info\)
* **Caryatis** SpinStun durations have been changed to be pulled from the effect\_value, instead of buff duration\(which stopped alot from working\), also spins mobs now
* **Caryatis** Implemented SE\_Fearless\(Valiant Companion\), SE\_AntiGate\(Translocational Anchor\), SE\_DispelBeneficial\(various spells and clicks\)
* **Caryatis** Implemented SE\_IncreaseBlockChance, SE\_CurrentEnduranceOnce, SE\_CurrentManaOnce, SE\_AEMelee\(duration rampage\)
* **Caryatis** Persistent Casting AA is now functional\(required sql\)
* **Caryatis** Rampage\(-\) and Destructive Force\(+\) have changed, the duration on both has been altered based on the live spell info\(required sql\)
* **Caryatis** Flurry will no longer hit the highest on hatelist, it will hit the mobs current target like live\(fixes rooted flurrying mobs\).
* **Caryatis** Updated spdat.h with current status of all spell effects
* **Caryatis** Reorganized spell\_effects.cpp to remove alot of the clutter of effects handled elsewhere

Required SQL: utils/sql/svn/1803\_required\_tasks\_xpreward\_signed.sql utils/sql/svn/1804\_required\_ae\_melee\_updates.sql

## 01/04/2011

* **Trevius** \(l0stmancd\) BagType 53 can now be used as an Augmentation Sealer from inventory.
* **Caryatis** Implemented SE\_Doppelganger\(Doppelganger AA is now functional\)

Required SQL: utils/sql/svn/1802\_required\_doppelganger.sql

## 01/03/2011

* **Caryatis** Implemented SE\_GravityEffect\(424\)
* **Caryatis** Added rule for endurance to be included in rest regeneration

Optional SQL: utils/sql/svn/1799\_optional\_rest\_regen\_endurance\_rule.sql

## 12/11/03

* **LethalEncounter** Added Archery in for pvp.
* **LethalEncounter** Fixed a throw bug.
* **LethalEncounter** Fixed char select colors not matching your colors in game.

## 11/11/03

* **Doodman** Fixed zone crash in CheckCloseArrgo\(\) during assist checking based on

  flawed if logic.

## 11/11/03

* **LethalEncounter** Fixed Stamina issues.

## 10/11/03

* **Trumpcard** Lots of performance improvements to combat code/AI code. Streamlined several calls, and found and removed unneeded calls

  ```text
   in MobAI that were causing serious bottlenecks.  Went through and caught a few memory leaks, and converted
   many deletes to safe deletes.
  ```

